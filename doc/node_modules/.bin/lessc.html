<!DOCTYPE html>
<html>
<head>
  <title>lessc</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/.bin/lessc";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>lessc</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">#!/usr/bin/env node</span>

<span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>),
    fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../lib/less-node/fs'</span>),
    os = <span class="hljs-built_in">require</span>(<span class="hljs-string">"os"</span>),
    errno,
    mkdirp;

<span class="hljs-keyword">try</span> {
    errno = <span class="hljs-built_in">require</span>(<span class="hljs-string">'errno'</span>);
} <span class="hljs-keyword">catch</span> (err) {
    errno = <span class="hljs-literal">null</span>;
}

<span class="hljs-keyword">var</span> less = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../lib/less-node'</span>),
    pluginLoader = <span class="hljs-keyword">new</span> less.PluginLoader(less),
    plugin,
    plugins = [];

<span class="hljs-keyword">var</span> args = process.argv.slice(<span class="hljs-number">1</span>);
<span class="hljs-keyword">var</span> silent = <span class="hljs-literal">false</span>,
    verbose = <span class="hljs-literal">false</span>,
    options = {
    <span class="hljs-attr">depends</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">compress</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">max_line_len</span>: <span class="hljs-number">-1</span>,
    <span class="hljs-attr">lint</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">paths</span>: [],
    <span class="hljs-attr">color</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">strictImports</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">insecure</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">rootpath</span>: <span class="hljs-string">''</span>,
    <span class="hljs-attr">relativeUrls</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">ieCompat</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">strictMath</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">strictUnits</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">globalVars</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">modifyVars</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">urlArgs</span>: <span class="hljs-string">''</span>,
    <span class="hljs-attr">plugins</span>: plugins
};
<span class="hljs-keyword">var</span> sourceMapOptions = {};
<span class="hljs-keyword">var</span> continueProcessing = <span class="hljs-literal">true</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>Calling process.exit does not flush stdout always. Instead of exiting the process, we set the process' exitCode,
close all handles and wait for the event loop to exit the process.
@see https://github.com/nodejs/node/issues/6409
Unfortunately, node 0.10.x does not support setting process.exitCode, so we need to call reallyExit() explicitly.
@see https://nodejs.org/api/process.html#process_process_exitcode
Additionally we also need to make sure that uncaughtExceptions are never swallowed.
@see https://github.com/less/less.js/issues/2881
This code can safely be removed if node 0.10.x is not supported anymore.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">process.on(<span class="hljs-string">"exit"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ process.reallyExit(process.exitCode); });
process.on(<span class="hljs-string">"uncaughtException"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
    <span class="hljs-built_in">console</span>.error(err);
    process.exitCode = <span class="hljs-number">1</span>;
});
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>This code will still be required because otherwise rejected promises would not be reported to the user</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">process.on(<span class="hljs-string">"unhandledRejection"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
    <span class="hljs-built_in">console</span>.error(err);
    process.exitCode = <span class="hljs-number">1</span>;
});

<span class="hljs-keyword">var</span> checkArgFunc = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">arg, option</span>) </span>{
    <span class="hljs-keyword">if</span> (!option) {
        <span class="hljs-built_in">console</span>.error(arg + <span class="hljs-string">" option requires a parameter"</span>);
        continueProcessing = <span class="hljs-literal">false</span>;
        process.exitCode = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
};

<span class="hljs-keyword">var</span> checkBooleanArg = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">arg</span>) </span>{
    <span class="hljs-keyword">var</span> onOff = <span class="hljs-regexp">/^((on|t|true|y|yes)|(off|f|false|n|no))$/i</span>.exec(arg);
    <span class="hljs-keyword">if</span> (!onOff) {
        <span class="hljs-built_in">console</span>.error(<span class="hljs-string">" unable to parse "</span> + arg + <span class="hljs-string">" as a boolean. use one of on/t/true/y/yes/off/f/false/n/no"</span>);
        continueProcessing = <span class="hljs-literal">false</span>;
        process.exitCode = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Boolean</span>(onOff[<span class="hljs-number">2</span>]);
};

<span class="hljs-keyword">var</span> parseVariableOption = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">option, variables</span>) </span>{
    <span class="hljs-keyword">var</span> parts = option.split(<span class="hljs-string">'='</span>, <span class="hljs-number">2</span>);
    variables[parts[<span class="hljs-number">0</span>]] = parts[<span class="hljs-number">1</span>];
};

<span class="hljs-keyword">var</span> sourceMapFileInline = <span class="hljs-literal">false</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">printUsage</span>(<span class="hljs-params"></span>) </span>{
    less.lesscHelper.printUsage();
    pluginLoader.printUsage(plugins);
    continueProcessing = <span class="hljs-literal">false</span>;
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>self executing function so we can return</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    args = args.filter(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">arg</span>) </span>{
        <span class="hljs-keyword">var</span> match;

        match = arg.match(<span class="hljs-regexp">/^-I(.+)$/</span>);
        <span class="hljs-keyword">if</span> (match) {
            options.paths.push(match[<span class="hljs-number">1</span>]);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        match = arg.match(<span class="hljs-regexp">/^--?([a-z][0-9a-z-]*)(?:=(.*))?$/i</span>);
        <span class="hljs-keyword">if</span> (match) {
            arg = match[<span class="hljs-number">1</span>];
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> arg;
        }

        <span class="hljs-keyword">switch</span> (arg) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'v'</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-string">'version'</span>:
                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"lessc "</span> + less.version.join(<span class="hljs-string">'.'</span>) + <span class="hljs-string">" (Less Compiler) [JavaScript]"</span>);
                continueProcessing = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'verbose'</span>:
                verbose = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'s'</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-string">'silent'</span>:
                silent = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'l'</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-string">'lint'</span>:
                options.lint = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'strict-imports'</span>:
                options.strictImports = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'h'</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-string">'help'</span>:
                printUsage();
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'x'</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-string">'compress'</span>:
                options.compress = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'insecure'</span>:
                options.insecure = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'M'</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-string">'depends'</span>:
                options.depends = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'max-line-len'</span>:
                <span class="hljs-keyword">if</span> (checkArgFunc(arg, match[<span class="hljs-number">2</span>])) {
                    options.maxLineLen = <span class="hljs-built_in">parseInt</span>(match[<span class="hljs-number">2</span>], <span class="hljs-number">10</span>);
                    <span class="hljs-keyword">if</span> (options.maxLineLen &lt;= <span class="hljs-number">0</span>) {
                        options.maxLineLen = <span class="hljs-number">-1</span>;
                    }
                }
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'no-color'</span>:
                options.color = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'no-ie-compat'</span>:
                options.ieCompat = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'no-js'</span>:
                options.javascriptEnabled = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'include-path'</span>:
                <span class="hljs-keyword">if</span> (checkArgFunc(arg, match[<span class="hljs-number">2</span>])) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>; supported on windows.
: supported on windows and linux, excluding a drive letter like C:\ so C:\file:D:\file parses to 2</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                    options.paths = match[<span class="hljs-number">2</span>]
                        .split(os.type().match(<span class="hljs-regexp">/Windows/</span>) ? <span class="hljs-regexp">/:(?!\\)|;/</span> : <span class="hljs-string">':'</span>)
                        .map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">p</span>) </span>{
                            <span class="hljs-keyword">if</span> (p) {
                                <span class="hljs-keyword">return</span> path.resolve(process.cwd(), p);
                            }
                        });
                }
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'line-numbers'</span>:
                <span class="hljs-keyword">if</span> (checkArgFunc(arg, match[<span class="hljs-number">2</span>])) {
                    options.dumpLineNumbers = match[<span class="hljs-number">2</span>];
                }
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'source-map'</span>:
                options.sourceMap = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">if</span> (match[<span class="hljs-number">2</span>]) {
                    sourceMapOptions.sourceMapFullFilename = match[<span class="hljs-number">2</span>];
                }
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'source-map-rootpath'</span>:
                <span class="hljs-keyword">if</span> (checkArgFunc(arg, match[<span class="hljs-number">2</span>])) {
                    sourceMapOptions.sourceMapRootpath = match[<span class="hljs-number">2</span>];
                }
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'source-map-basepath'</span>:
                <span class="hljs-keyword">if</span> (checkArgFunc(arg, match[<span class="hljs-number">2</span>])) {
                    sourceMapOptions.sourceMapBasepath = match[<span class="hljs-number">2</span>];
                }
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'source-map-map-inline'</span>:
                sourceMapFileInline = <span class="hljs-literal">true</span>;
                options.sourceMap = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'source-map-less-inline'</span>:
                sourceMapOptions.outputSourceFiles = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'source-map-url'</span>:
                <span class="hljs-keyword">if</span> (checkArgFunc(arg, match[<span class="hljs-number">2</span>])) {
                    sourceMapOptions.sourceMapURL = match[<span class="hljs-number">2</span>];
                }
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'rp'</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-string">'rootpath'</span>:
                <span class="hljs-keyword">if</span> (checkArgFunc(arg, match[<span class="hljs-number">2</span>])) {
                    options.rootpath = match[<span class="hljs-number">2</span>].replace(<span class="hljs-regexp">/\\/g</span>, <span class="hljs-string">'/'</span>);
                }
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"ru"</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-string">"relative-urls"</span>:
                options.relativeUrls = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"sm"</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-string">"strict-math"</span>:
                <span class="hljs-keyword">if</span> (checkArgFunc(arg, match[<span class="hljs-number">2</span>])) {
                    options.strictMath = checkBooleanArg(match[<span class="hljs-number">2</span>]);
                }
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"su"</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-string">"strict-units"</span>:
                <span class="hljs-keyword">if</span> (checkArgFunc(arg, match[<span class="hljs-number">2</span>])) {
                    options.strictUnits = checkBooleanArg(match[<span class="hljs-number">2</span>]);
                }
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"global-var"</span>:
                <span class="hljs-keyword">if</span> (checkArgFunc(arg, match[<span class="hljs-number">2</span>])) {
                    <span class="hljs-keyword">if</span> (!options.globalVars) {
                        options.globalVars = {};
                    }
                    parseVariableOption(match[<span class="hljs-number">2</span>], options.globalVars);
                }
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"modify-var"</span>:
                <span class="hljs-keyword">if</span> (checkArgFunc(arg, match[<span class="hljs-number">2</span>])) {
                    <span class="hljs-keyword">if</span> (!options.modifyVars) {
                        options.modifyVars = {};
                    }

                    parseVariableOption(match[<span class="hljs-number">2</span>], options.modifyVars);
                }
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'url-args'</span>:
                <span class="hljs-keyword">if</span> (checkArgFunc(arg, match[<span class="hljs-number">2</span>])) {
                    options.urlArgs = match[<span class="hljs-number">2</span>];
                }
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'plugin'</span>:
                <span class="hljs-keyword">var</span> splitupArg = match[<span class="hljs-number">2</span>].match(<span class="hljs-regexp">/^([^=]+)(=(.*))?/</span>),
                    name = splitupArg[<span class="hljs-number">1</span>],
                    pluginOptions = splitupArg[<span class="hljs-number">3</span>];

                plugin = pluginLoader.tryLoadPlugin(name, pluginOptions);
                <span class="hljs-keyword">if</span> (plugin) {
                    plugins.push(plugin);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-built_in">console</span>.error(<span class="hljs-string">"Unable to load plugin "</span> + name +
                        <span class="hljs-string">" please make sure that it is installed under or at the same level as less"</span>);
                    process.exitCode = <span class="hljs-number">1</span>;
                }
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">default</span>:
                plugin = pluginLoader.tryLoadPlugin(<span class="hljs-string">"less-plugin-"</span> + arg, match[<span class="hljs-number">2</span>]);
                <span class="hljs-keyword">if</span> (plugin) {
                    plugins.push(plugin);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-built_in">console</span>.error(<span class="hljs-string">"Unable to interpret argument "</span> + arg +
                        <span class="hljs-string">" - if it is a plugin (less-plugin-"</span> + arg + <span class="hljs-string">"), make sure that it is installed under or at"</span> +
                        <span class="hljs-string">" the same level as less"</span>);
                    process.exitCode = <span class="hljs-number">1</span>;
                }
                <span class="hljs-keyword">break</span>;
        }
    });

    <span class="hljs-keyword">if</span> (!continueProcessing) {
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">var</span> input = args[<span class="hljs-number">1</span>];
    <span class="hljs-keyword">if</span> (input &amp;&amp; input != <span class="hljs-string">'-'</span>) {
        input = path.resolve(process.cwd(), input);
    }
    <span class="hljs-keyword">var</span> output = args[<span class="hljs-number">2</span>];
    <span class="hljs-keyword">var</span> outputbase = args[<span class="hljs-number">2</span>];
    <span class="hljs-keyword">if</span> (output) {
        output = path.resolve(process.cwd(), output);
    }

    <span class="hljs-keyword">if</span> (options.sourceMap) {

        sourceMapOptions.sourceMapInputFilename = input;
        <span class="hljs-keyword">if</span> (!sourceMapOptions.sourceMapFullFilename) {
            <span class="hljs-keyword">if</span> (!output &amp;&amp; !sourceMapFileInline) {
                <span class="hljs-built_in">console</span>.error(<span class="hljs-string">"the sourcemap option only has an optional filename if the css filename is given"</span>);
                <span class="hljs-built_in">console</span>.error(<span class="hljs-string">"consider adding --source-map-map-inline which embeds the sourcemap into the css"</span>);
                process.exitCode = <span class="hljs-number">1</span>;
                <span class="hljs-keyword">return</span>;
            }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>its in the same directory, so always just the basename</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">if</span> (output) {
                sourceMapOptions.sourceMapOutputFilename = path.basename(output);
                sourceMapOptions.sourceMapFullFilename = output + <span class="hljs-string">".map"</span>;
            }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>its in the same directory, so always just the basename</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">if</span> (<span class="hljs-string">'sourceMapFullFilename'</span> <span class="hljs-keyword">in</span> sourceMapOptions) {
                sourceMapOptions.sourceMapFilename = path.basename(sourceMapOptions.sourceMapFullFilename);
            }
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (options.sourceMap &amp;&amp; !sourceMapFileInline) {
            <span class="hljs-keyword">var</span> mapFilename = path.resolve(process.cwd(), sourceMapOptions.sourceMapFullFilename),
                mapDir = path.dirname(mapFilename),
                outputDir = path.dirname(output);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>find the path from the map to the output file</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            sourceMapOptions.sourceMapOutputFilename = path.join(
                path.relative(mapDir, outputDir), path.basename(output));

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>make the sourcemap filename point to the sourcemap relative to the css file output directory</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            sourceMapOptions.sourceMapFilename = path.join(
                path.relative(outputDir, mapDir), path.basename(sourceMapOptions.sourceMapFullFilename));
        }
    }

    <span class="hljs-keyword">if</span> (sourceMapOptions.sourceMapBasepath === <span class="hljs-literal">undefined</span>) {
        sourceMapOptions.sourceMapBasepath = input ? path.dirname(input) : process.cwd();
    }

    <span class="hljs-keyword">if</span> (sourceMapOptions.sourceMapRootpath === <span class="hljs-literal">undefined</span>) {
        <span class="hljs-keyword">var</span> pathToMap = path.dirname((sourceMapFileInline ? output : sourceMapOptions.sourceMapFullFilename) || <span class="hljs-string">'.'</span>),
            pathToInput = path.dirname(sourceMapOptions.sourceMapInputFilename || <span class="hljs-string">'.'</span>);
        sourceMapOptions.sourceMapRootpath = path.relative(pathToMap, pathToInput);
    }

    <span class="hljs-keyword">if</span> (! input) {
        <span class="hljs-built_in">console</span>.error(<span class="hljs-string">"lessc: no input files"</span>);
        <span class="hljs-built_in">console</span>.error(<span class="hljs-string">""</span>);
        printUsage();
        process.exitCode = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">var</span> ensureDirectory = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">filepath</span>) </span>{
        <span class="hljs-keyword">var</span> dir = path.dirname(filepath),
            cmd,
            existsSync = fs.existsSync || path.existsSync;
        <span class="hljs-keyword">if</span> (!existsSync(dir)) {
            <span class="hljs-keyword">if</span> (mkdirp === <span class="hljs-literal">undefined</span>) {
                <span class="hljs-keyword">try</span> {mkdirp = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mkdirp'</span>);}
                <span class="hljs-keyword">catch</span>(e) { mkdirp = <span class="hljs-literal">null</span>; }
            }
            cmd = mkdirp &amp;&amp; mkdirp.sync || fs.mkdirSync;
            cmd(dir);
        }
    };

    <span class="hljs-keyword">if</span> (options.depends) {
        <span class="hljs-keyword">if</span> (!outputbase) {
            <span class="hljs-built_in">console</span>.error(<span class="hljs-string">"option --depends requires an output path to be specified"</span>);
            process.exitCode = <span class="hljs-number">1</span>;
            <span class="hljs-keyword">return</span>;
        }
        process.stdout.write(outputbase + <span class="hljs-string">": "</span>);
    }

    <span class="hljs-keyword">if</span> (!sourceMapFileInline) {
        <span class="hljs-keyword">var</span> writeSourceMap = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">output, onDone</span>) </span>{
            output = output || <span class="hljs-string">""</span>;
            <span class="hljs-keyword">var</span> filename = sourceMapOptions.sourceMapFullFilename;
            ensureDirectory(filename);
            fs.writeFile(filename, output, <span class="hljs-string">'utf8'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
                <span class="hljs-keyword">if</span> (err) {
                    <span class="hljs-keyword">var</span> description = <span class="hljs-string">"Error: "</span>;
                    <span class="hljs-keyword">if</span> (errno &amp;&amp; errno.errno[err.errno]) {
                        description += errno.errno[err.errno].description;
                    } <span class="hljs-keyword">else</span> {
                        description += err.code + <span class="hljs-string">" "</span> + err.message;
                    }
                    <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'lessc: failed to create file '</span> + filename);
                    <span class="hljs-built_in">console</span>.error(description);
                    process.exitCode = <span class="hljs-number">1</span>;
                } <span class="hljs-keyword">else</span> {
                    less.logger.info(<span class="hljs-string">'lessc: wrote '</span> + filename);
                }
                onDone();
            });
        };
    }

    <span class="hljs-keyword">var</span> writeSourceMapIfNeeded = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">output, onDone</span>) </span>{
        <span class="hljs-keyword">if</span> (options.sourceMap &amp;&amp; !sourceMapFileInline) {
            writeSourceMap(output, onDone);
        } <span class="hljs-keyword">else</span> {
            onDone();
        }
    };

    <span class="hljs-keyword">var</span> writeOutput = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">output, result, onSuccess</span>) </span>{
        <span class="hljs-keyword">if</span> (options.depends) {
            onSuccess();
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (output) {
            ensureDirectory(output);
            fs.writeFile(output, result.css, {<span class="hljs-attr">encoding</span>: <span class="hljs-string">'utf8'</span>}, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
                <span class="hljs-keyword">if</span> (err) {
                    <span class="hljs-keyword">var</span> description = <span class="hljs-string">"Error: "</span>;
                    <span class="hljs-keyword">if</span> (errno &amp;&amp; errno.errno[err.errno]) {
                        description += errno.errno[err.errno].description;
                    } <span class="hljs-keyword">else</span> {
                        description += err.code + <span class="hljs-string">" "</span> + err.message;
                    }
                    <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'lessc: failed to create file '</span> + output);
                    <span class="hljs-built_in">console</span>.error(description);
                    process.exitCode = <span class="hljs-number">1</span>;
                } <span class="hljs-keyword">else</span> {
                    less.logger.info(<span class="hljs-string">'lessc: wrote '</span> + output);
                    onSuccess();
                }
            });
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!options.depends) {
            process.stdout.write(result.css);
            onSuccess();
        }
    };

    <span class="hljs-keyword">var</span> logDependencies = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options, result</span>) </span>{
        <span class="hljs-keyword">if</span> (options.depends) {
            <span class="hljs-keyword">var</span> depends = <span class="hljs-string">""</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; result.imports.length; i++) {
                depends += result.imports[i] + <span class="hljs-string">" "</span>;
            }
            <span class="hljs-built_in">console</span>.log(depends);
        }
    };

    <span class="hljs-keyword">var</span> parseLessFile = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e, data</span>) </span>{
        <span class="hljs-keyword">if</span> (e) {
            <span class="hljs-built_in">console</span>.error(<span class="hljs-string">"lessc: "</span> + e.message);
            process.exitCode = <span class="hljs-number">1</span>;
            <span class="hljs-keyword">return</span>;
        }

        data = data.replace(<span class="hljs-regexp">/^\uFEFF/</span>, <span class="hljs-string">''</span>);

        options.paths = [path.dirname(input)].concat(options.paths);
        options.filename = input;

        <span class="hljs-keyword">if</span> (options.lint) {
            options.sourceMap = <span class="hljs-literal">false</span>;
        }
        sourceMapOptions.sourceMapFileInline = sourceMapFileInline;

        <span class="hljs-keyword">if</span> (options.sourceMap) {
            options.sourceMap = sourceMapOptions;
        }

        less.logger.addListener({
            <span class="hljs-attr">info</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg</span>) </span>{
                <span class="hljs-keyword">if</span> (verbose) {
                    <span class="hljs-built_in">console</span>.log(msg);
                }
            },
            <span class="hljs-attr">warn</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>do not show warning if the silent option is used</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                <span class="hljs-keyword">if</span> (!silent) {
                    <span class="hljs-built_in">console</span>.warn(msg);
                }
            },
            <span class="hljs-attr">error</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg</span>) </span>{
                <span class="hljs-built_in">console</span>.error(msg);
            }
        });

        less.render(data, options)
            .then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{
                <span class="hljs-keyword">if</span> (!options.lint) {
                    writeOutput(output, result, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        writeSourceMapIfNeeded(result.map, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            logDependencies(options, result);
                        });
                    });
                }
            },
            <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
                less.writeError(err, options);
                process.exitCode = <span class="hljs-number">1</span>;
            });
    };

    <span class="hljs-keyword">if</span> (input != <span class="hljs-string">'-'</span>) {
        fs.readFile(input, <span class="hljs-string">'utf8'</span>, parseLessFile);
    } <span class="hljs-keyword">else</span> {
        process.stdin.resume();
        process.stdin.setEncoding(<span class="hljs-string">'utf8'</span>);

        <span class="hljs-keyword">var</span> buffer = <span class="hljs-string">''</span>;
        process.stdin.on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
            buffer += data;
        });

        process.stdin.on(<span class="hljs-string">'end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            parseLessFile(<span class="hljs-literal">false</span>, buffer);
        });
    }
})();

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
